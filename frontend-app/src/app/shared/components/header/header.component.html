<mat-toolbar class="app-header" color="primary">
  <div class="header-container">
    <!-- Logo and Brand -->
    <div class="brand-section" routerLink="/dashboard" [class.clickable]="currentUser">
      <mat-icon class="brand-icon">restaurant_menu</mat-icon>
      <span class="brand-name">NutriMind</span>
    </div>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav" *ngIf="currentUser">
      <button mat-button routerLink="/dashboard" routerLinkActive="active-link">
        <mat-icon>dashboard</mat-icon>
        Dashboard
      </button>
      <button mat-button routerLink="/meal-plans" routerLinkActive="active-link">
        <mat-icon>calendar_today</mat-icon>
        Meal Plans
      </button>
      <button mat-button routerLink="/recipes" routerLinkActive="active-link">
        <mat-icon>book</mat-icon>
        Recipes
      </button>
      <button mat-button routerLink="/grocery-lists" routerLinkActive="active-link">
        <mat-icon>shopping_cart</mat-icon>
        Grocery
      </button>
    </nav>

    <!-- User Menu -->
    <div class="user-section" *ngIf="currentUser">
      <!-- Notifications -->
      <button mat-icon-button routerLink="/notifications" matTooltip="Notifications">
        <mat-icon matBadge="3" matBadgeColor="accent">notifications</mat-icon>
      </button>

      <!-- User Avatar & Menu -->
      <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-avatar">
        <div class="avatar-circle">{{ userInitials }}</div>
      </button>
      
      <mat-menu #userMenu="matMenu" class="user-menu">
        <div class="user-info">
          <div class="user-name">{{ currentUser.firstName }} {{ currentUser.lastName }}</div>
          <div class="user-email">{{ currentUser.email }}</div>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/profile">
          <mat-icon>person</mat-icon>
          <span>Profile</span>
        </button>
        <button mat-menu-item routerLink="/integrations">
          <mat-icon>settings</mat-icon>
          <span>Integrations</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
          <mat-icon>exit_to_app</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    </div>

    <!-- Mobile Menu Toggle -->
    <button mat-icon-button class="mobile-menu-toggle" *ngIf="currentUser" (click)="toggleMenu()">
      <mat-icon>menu</mat-icon>
    </button>
  </div>
</mat-toolbar>

<!-- Mobile Navigation Drawer -->
<mat-sidenav-container class="mobile-nav-container" [class.open]="isMenuOpen" *ngIf="currentUser">
  <mat-sidenav mode="over" [opened]="isMenuOpen" (closed)="isMenuOpen = false" position="end">
    <div class="mobile-nav-header">
      <div class="user-info">
        <div class="avatar-circle large">{{ userInitials }}</div>
        <div class="user-details">
          <div class="user-name">{{ currentUser.firstName }} {{ currentUser.lastName }}</div>
          <div class="user-email">{{ currentUser.email }}</div>
        </div>
      </div>
    </div>
    
    <mat-nav-list>
      <a mat-list-item routerLink="/dashboard" (click)="navigateTo('/dashboard')">
        <mat-icon matListIcon>dashboard</mat-icon>
        <span matLine>Dashboard</span>
      </a>
      <a mat-list-item routerLink="/meal-plans" (click)="navigateTo('/meal-plans')">
        <mat-icon matListIcon>calendar_today</mat-icon>
        <span matLine>Meal Plans</span>
      </a>
      <a mat-list-item routerLink="/recipes" (click)="navigateTo('/recipes')">
        <mat-icon matListIcon>book</mat-icon>
        <span matLine>Recipes</span>
      </a>
      <a mat-list-item routerLink="/grocery-lists" (click)="navigateTo('/grocery-lists')">
        <mat-icon matListIcon>shopping_cart</mat-icon>
        <span matLine>Grocery Lists</span>
      </a>
      <a mat-list-item routerLink="/notifications" (click)="navigateTo('/notifications')">
        <mat-icon matListIcon>notifications</mat-icon>
        <span matLine>Notifications</span>
      </a>
      <a mat-list-item routerLink="/profile" (click)="navigateTo('/profile')">
        <mat-icon matListIcon>person</mat-icon>
        <span matLine>Profile</span>
      </a>
      <a mat-list-item routerLink="/integrations" (click)="navigateTo('/integrations')">
        <mat-icon matListIcon>settings</mat-icon>
        <span matLine>Integrations</span>
      </a>
      <mat-divider></mat-divider>
      <a mat-list-item (click)="logout()">
        <mat-icon matListIcon>exit_to_app</mat-icon>
        <span matLine>Logout</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>
</mat-sidenav-container>
