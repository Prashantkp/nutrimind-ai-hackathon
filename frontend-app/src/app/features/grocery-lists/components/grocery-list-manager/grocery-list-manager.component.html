<!-- Loading Overlay -->
<div class="loading-overlay" *ngIf="isLoading">
  <app-loading size="large" message="Loading your grocery lists..."></app-loading>
</div>

<!-- Main Container -->
<div class="grocery-manager" *ngIf="!isLoading">
  <!-- Header -->
  <div class="manager-header">
    <div class="header-content">
      <h1>Grocery Lists</h1>
      <p class="subtitle">Manage your shopping lists and stay organized</p>
    </div>
    
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="createNewList()">
        <mat-icon>add</mat-icon>
        New List
      </button>
    </div>
  </div>

  <!-- Active List Display -->
  <div class="active-list" *ngIf="activeList">
    <mat-card class="list-card">
      <mat-card-header>
        <mat-card-title>{{ activeList.name }}</mat-card-title>
        <mat-card-subtitle *ngIf="activeList.description">{{ activeList.description }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <!-- Add New Item -->
        <div class="add-item-section">
          <mat-form-field appearance="outline" class="item-input">
            <mat-label>Add item</mat-label>
            <input matInput 
                   [(ngModel)]="newItemName"
                   placeholder="e.g., 2 lbs chicken breast"
                   (keydown.enter)="addItem()">
          </mat-form-field>
          
          <button mat-raised-button 
                  color="primary" 
                  (click)="addItem()"
                  [disabled]="!newItemName.trim()">
            <mat-icon>add</mat-icon>
            Add
          </button>
        </div>

        <!-- Items List -->
        <div class="items-list" *ngIf="activeList.items.length > 0">
          <h3>Items ({{ activeList.items.length }})</h3>
          <div class="items-container">
            <div *ngFor="let item of activeList.items; let i = index" 
                 class="item-row"
                 [class.completed]="item.isCompleted">
              
              <mat-checkbox 
                [(ngModel)]="item.isCompleted"
                color="primary">
              </mat-checkbox>
              
              <div class="item-content" [class.strike-through]="item.isCompleted">
                <span class="item-name">{{ item.ingredientName }}</span>
                <span class="item-quantity">{{ item.quantity }} {{ item.unit }}</span>
                <span class="item-cost" *ngIf="item.estimatedCost">
                  {{ item.estimatedCost | currency }}
                </span>
              </div>
              
              <button mat-icon-button (click)="removeItem(item)" class="delete-btn">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>

          <!-- Progress -->
          <div class="progress-section">
            <mat-progress-bar 
              mode="determinate" 
              [value]="getCompletionPercentage()"
              color="primary">
            </mat-progress-bar>
            <p class="progress-text">
              {{ getCompletedItemsCount() }} of {{ activeList.items.length }} items completed
            </p>
          </div>
        </div>

        <!-- Empty Items State -->
        <div class="empty-items" *ngIf="activeList.items.length === 0">
          <p>No items in this list yet. Add your first item above!</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- All Lists Display -->
  <div class="all-lists" *ngIf="groceryLists.length > 0">
    <h2>All Lists ({{ groceryLists.length }})</h2>
    <div class="lists-grid">
      <mat-card *ngFor="let list of groceryLists" 
                class="list-card" 
                [class.active]="list === activeList"
                (click)="selectList(list)">
        <mat-card-header>
          <mat-card-title>{{ list.name }}</mat-card-title>
          <mat-card-subtitle>{{ list.items.length }} items</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p *ngIf="list.description">{{ list.description }}</p>
          <div class="list-stats">
            <span class="stat">{{ getCompletedCount(list) }} completed</span>
            <span class="stat" *ngIf="list.totalEstimatedCost">{{ list.totalEstimatedCost | currency }}</span>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button (click)="editList(list); $event.stopPropagation()">Edit</button>
          <button mat-button (click)="deleteList(list); $event.stopPropagation()" color="warn">Delete</button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="groceryLists.length === 0">
    <div class="empty-content">
      <mat-icon class="empty-icon">shopping_cart</mat-icon>
      <h3>No Grocery Lists Yet</h3>
      <p>Create your first grocery list to start shopping smarter.</p>
      <button mat-raised-button color="primary" (click)="createNewList()">
        <mat-icon>add</mat-icon>
        Create First List
      </button>
    </div>
  </div>
</div>
