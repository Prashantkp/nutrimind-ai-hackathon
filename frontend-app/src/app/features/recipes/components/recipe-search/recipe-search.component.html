<div class="recipe-search-container">
  <!-- Search Header -->
  <div class="search-header">
    <div class="search-title">
      <h1>Discover Recipes</h1>
      <p>Find healthy and delicious recipes tailored to your preferences</p>
    </div>
    
    <!-- Search Form -->
    <form [formGroup]="searchForm" class="search-form">
      <mat-form-field appearance="outline" class="search-input">
        <mat-label>Search recipes...</mat-label>
        <input matInput formControlName="searchTerm" placeholder="Try 'chicken curry' or 'gluten-free dessert'">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="sort-select">
        <mat-label>Sort by</mat-label>
        <mat-select formControlName="sortBy" (selectionChange)="onSortChange()">
          <mat-option value="relevance">Relevance</mat-option>
          <mat-option value="name">Name</mat-option>
          <mat-option value="prepTime">Prep Time</mat-option>
          <mat-option value="calories">Calories</mat-option>
          <mat-option value="rating">Rating</mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>filter_list</mat-icon>
          Filters
        </mat-panel-title>
        <mat-panel-description>
          Customize your recipe search
        </mat-panel-description>
      </mat-expansion-panel-header>
      
      <div class="filters-content">
        <!-- Cuisine Types -->
        <div class="filter-group">
          <h3>Cuisine Type</h3>
          <mat-chip-set>
            <mat-chip-option 
              *ngFor="let cuisine of cuisineTypes" 
              [selected]="selectedCuisines.includes(cuisine)"
              (click)="onCuisineToggle(cuisine)">
              {{ cuisine }}
            </mat-chip-option>
          </mat-chip-set>
        </div>

        <!-- Dietary Restrictions -->
        <div class="filter-group">
          <h3>Dietary Preferences</h3>
          <mat-chip-set>
            <mat-chip-option 
              *ngFor="let dietary of dietaryRestrictions" 
              [selected]="selectedDietary.includes(dietary)"
              (click)="onDietaryToggle(dietary)">
              {{ dietary | titlecase }}
            </mat-chip-option>
          </mat-chip-set>
        </div>

        <!-- Meal Types -->
        <div class="filter-group">
          <h3>Meal Type</h3>
          <mat-chip-set>
            <mat-chip-option 
              *ngFor="let mealType of mealTypes" 
              [selected]="selectedMealTypes.includes(mealType)"
              (click)="onMealTypeToggle(mealType)">
              {{ mealType | titlecase }}
            </mat-chip-option>
          </mat-chip-set>
        </div>

        <!-- Preparation Time -->
        <div class="filter-group">
          <h3>Preparation Time</h3>
          <mat-radio-group [(ngModel)]="selectedPrepTime" (change)="onFilterChange()">
            <mat-radio-button [value]="0">Any time</mat-radio-button>
            <mat-radio-button 
              *ngFor="let time of preparationTimes" 
              [value]="time.value">
              {{ time.label }}
            </mat-radio-button>
          </mat-radio-group>
        </div>

        <!-- Difficulty Level -->
        <div class="filter-group">
          <h3>Difficulty Level</h3>
          <mat-radio-group [(ngModel)]="selectedDifficulty" (change)="onFilterChange()">
            <mat-radio-button value="">Any difficulty</mat-radio-button>
            <mat-radio-button 
              *ngFor="let difficulty of difficultyLevels" 
              [value]="difficulty">
              {{ difficulty | titlecase }}
            </mat-radio-button>
          </mat-radio-group>
        </div>

        <!-- Clear Filters Button -->
        <div class="filter-actions">
          <button mat-raised-button color="warn" (click)="clearFilters()">
            Clear All Filters
          </button>
        </div>
      </div>
    </mat-expansion-panel>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-section">
    <app-loading></app-loading>
  </div>

  <!-- Results Section -->
  <div *ngIf="!isLoading" class="results-section">
    <!-- Results Header -->
    <div class="results-header">
      <h2 *ngIf="searchPerformed">
        Search Results ({{ filteredRecipes.length }} recipes)
      </h2>
      <h2 *ngIf="!searchPerformed">
        Popular Recipes ({{ filteredRecipes.length }} recipes)
      </h2>
    </div>

    <!-- Recipe Grid -->
    <div class="recipes-grid" *ngIf="filteredRecipes.length > 0; else noRecipes">
      <mat-card class="recipe-card" *ngFor="let recipe of filteredRecipes">
        <!-- Recipe Image -->
        <div class="recipe-image" [style.background-image]="recipe.imageUrl ? 'url(' + recipe.imageUrl + ')' : 'none'">
          <div class="recipe-overlay">
            <button mat-icon-button class="favorite-btn" (click)="toggleFavorite(recipe)">
              <mat-icon>favorite_border</mat-icon>
            </button>
          </div>
        </div>

        <!-- Recipe Content -->
        <mat-card-content class="recipe-content">
          <div class="recipe-header">
            <h3 class="recipe-title" (click)="viewRecipeDetail(recipe.id)">{{ recipe.title }}</h3>
            <div class="recipe-rating" *ngIf="recipe.rating">
              <mat-icon class="star-icon">star</mat-icon>
              <span>{{ recipe.rating }}</span>
              <span class="review-count" *ngIf="recipe.reviewCount">({{ recipe.reviewCount }})</span>
            </div>
          </div>

          <p class="recipe-description" *ngIf="recipe.description">
            {{ recipe.description | slice:0:100 }}{{ recipe.description && recipe.description.length > 100 ? '...' : '' }}
          </p>

          <!-- Recipe Stats -->
          <div class="recipe-stats">
            <div class="stat-item">
              <mat-icon>schedule</mat-icon>
              <span>{{ recipe.prepTimeMinutes }} min</span>
            </div>
            <div class="stat-item">
              <mat-icon>restaurant</mat-icon>
              <span>{{ recipe.servings }} servings</span>
            </div>
            <div class="stat-item" *ngIf="recipe.nutrition?.calories">
              <mat-icon>local_fire_department</mat-icon>
              <span>{{ recipe.nutrition.calories }} cal</span>
            </div>
            <div class="stat-item" *ngIf="recipe.difficulty">
              <mat-icon>trending_up</mat-icon>
              <span>{{ recipe.difficulty | titlecase }}</span>
            </div>
          </div>

          <!-- Recipe Tags -->
          <div class="recipe-tags" *ngIf="recipe.tags && recipe.tags.length > 0">
            <mat-chip-set>
              <mat-chip *ngFor="let tag of recipe.tags.slice(0, 3)">{{ tag }}</mat-chip>
            </mat-chip-set>
          </div>

          <!-- Cuisine Type -->
          <div class="recipe-cuisine" *ngIf="recipe.cuisine">
            <mat-icon>public</mat-icon>
            <span>{{ recipe.cuisine }}</span>
          </div>
        </mat-card-content>

        <!-- Recipe Actions -->
        <mat-card-actions class="recipe-actions">
          <button mat-button color="primary" (click)="viewRecipeDetail(recipe.id)">
            View Recipe
          </button>
          <button mat-button color="accent" (click)="addToMealPlan(recipe)">
            Add to Plan
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- No Results -->
    <ng-template #noRecipes>
      <div class="no-results">
        <mat-icon class="no-results-icon">restaurant</mat-icon>
        <h3>No recipes found</h3>
        <p *ngIf="searchPerformed">
          Try adjusting your search terms or filters to find more recipes.
        </p>
        <p *ngIf="!searchPerformed">
          Something went wrong loading recipes. Please try again.
        </p>
        <button mat-raised-button color="primary" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
    </ng-template>
  </div>
</div>
